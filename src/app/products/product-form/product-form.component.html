<form [formGroup]="form" (ngSubmit)="save()">

  <!-- 1. Descripción -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Descripción*</mat-label>
    <textarea matInput formControlName="descripcion"></textarea>
    <mat-error *ngIf="form.get('descripcion')?.hasError('required')">
      La descripción es obligatoria
    </mat-error>
    <mat-error *ngIf="form.get('descripcion')?.hasError('minlength')">
      Mínimo 3 caracteres
    </mat-error>
    <mat-error *ngIf="form.get('descripcion')?.hasError('maxlength')">
      Máximo 255 caracteres
    </mat-error>
  </mat-form-field>

  <!-- 2. Costo Compra -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Costo Compra*</mat-label>
    <input matInput type="number" formControlName="costoCompra">
    <mat-error *ngIf="form.get('costoCompra')?.hasError('required')">
      El costo es obligatorio
    </mat-error>
    <mat-error *ngIf="form.get('costoCompra')?.hasError('min')">
      El costo debe ser ≥ 0
    </mat-error>
  </mat-form-field>

  <!-- 3. Estado -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Estado (1=Activo, 0=Inactivo)*</mat-label>
    <input matInput type="number" formControlName="estado">
    <mat-error *ngIf="form.get('estado')?.hasError('required')">
      El estado es obligatorio
    </mat-error>
    <mat-error *ngIf="form.get('estado')?.hasError('pattern')">
      Sólo puede ser 0 o 1
    </mat-error>
  </mat-form-field>

  <!-- 4. Existencia -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Existencia*</mat-label>
    <input matInput type="number" formControlName="existencia">
    <mat-error *ngIf="form.get('existencia')?.hasError('required')">
      La existencia es obligatoria
    </mat-error>
    <mat-error *ngIf="form.get('existencia')?.hasError('min')">
      La existencia debe ser ≥ 0
    </mat-error>
  </mat-form-field>

  <!-- 5. Precio Venta Actual -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Precio Venta Actual*</mat-label>
    <input matInput type="number" formControlName="precioVentaActual">
    <mat-error *ngIf="form.get('precioVentaActual')?.hasError('required')">
      El precio es obligatorio
    </mat-error>
    <mat-error *ngIf="form.get('precioVentaActual')?.hasError('min')">
      El precio debe ser ≥ 0
    </mat-error>
  </mat-form-field>

  <!-- 6. Precio Venta Anterior -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Precio Venta Anterior</mat-label>
    <input matInput type="number" formControlName="precioVentaAnterior">
    <mat-error *ngIf="form.get('precioVentaAnterior')?.hasError('min')">
      El precio anterior debe ser ≥ 0
    </mat-error>
  </mat-form-field>

  <!-- 7. Validación cruzada: precios -->
  <mat-error *ngIf="form.hasError('priceMismatch')">
    El precio anterior no puede superar al actual
  </mat-error>

  <!-- 8. Referencia -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Referencia*</mat-label>
    <input matInput formControlName="referencia">
    <mat-error *ngIf="form.get('referencia')?.hasError('required')">
      La referencia es obligatoria
    </mat-error>
    <mat-error *ngIf="form.get('referencia')?.hasError('minlength')">
      Mínimo 3 caracteres
    </mat-error>
    <mat-error *ngIf="form.get('referencia')?.hasError('maxlength')">
      Máximo 50 caracteres
    </mat-error>
  </mat-form-field>

  <!-- 9. Stock Máximo -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Stock Máximo*</mat-label>
    <input matInput type="number" formControlName="stockMaximo">
    <mat-error *ngIf="form.get('stockMaximo')?.hasError('required')">
      El stock máximo es obligatorio
    </mat-error>
    <mat-error *ngIf="form.get('stockMaximo')?.hasError('min')">
      El stock debe ser ≥ 0
    </mat-error>
  </mat-form-field>

  <!-- 10. Tiene IVA -->
  <mat-checkbox formControlName="tieneIva">
    Tiene IVA
  </mat-checkbox>

  <!-- 11. Foto Producto -->
  <div class="image-upload">
    <label>Foto Producto:</label><br>
    <input type="file" (change)="onFileSelected($event)" accept="image/*">
  </div>
  <img *ngIf="form.value.fotoProducto"
       [src]="form.value.fotoProducto"
       alt="Vista previa"
       style="max-width:150px; margin:12px 0; display:block;">

  <!-- 12. Botones -->
  <div style="margin-top:24px;">
    <button mat-raised-button color="primary" type="submit"
            [disabled]="form.invalid">
      Guardar
    </button>
    <button mat-button type="button" (click)="cancel()">
      Cancelar
    </button>
  </div>
</form>
